---
title:  "analyze a security incident with splunk"
date:   2018-11-18
categories: [CTF]
tags: [TEKO]
---
#### Introduction
As part of my [further training](https://www.teko.ch), I have to analyze a security incident with splunk. Therefore, I was given access to a Splunk-enviroment and received a list with a couple of questions like `What was the first brute force password used?`. I didn't receive any further information. 
As I'm a complete newby with Splunk, I presume that I will be pretty challenged :-)

#### Preparation
##### thoughts
the questions, which I have to answer to, are unsorted, but the data seem to be structured. Some of the questions seem easier, some harder to answer to. I'm pretty sure that, once sorted the right way, the questions will lead me through the sec-incident.
##### approach
I imported the questionlist as csv in Excel and sorted it by the column _Number_ 
##### result
The first question is now `This is a simple question to get you familiar with submitting answers. What is the name of the company that makes the software that you are using for this competition? Just a six-letter word with no punctuation.`, so I'm pretty sure to have the list ordered the right way. By the way, the right answer is `Splunk`.

#### 101-What is the likely IP address of someone from the Po1s0n1vy group scanning imreallynotbatman.com for web application vulnerabilities? 
##### thoughts
this question shouldn't be too hard to answer. As an automated scan generates lots of requests, there should be some traces in the logfiles.
##### approach
to narrow the log-data, I set the query `index=* imreallynotbatman.com`. Because I have no idea when the incident happened, I set the option _all times_.
A quick look to the field _src-ip_ revealed that more than 70% of the traffic was generated by the ip 40.80.148.42. To narrow the data further, I set the query `index=* imreallynotbatman.com sourcetype="stream:http"`, because the vulnerability-scan of a web-app will generate most likely http-traffic. Now, 94.424% of the collected data stick to 40.80.148.42.
##### result
the most likely ip is 40.80.148.42
![Solution q101](/images/splunk/101_1.png)


###### 102-What company created the web vulnerability scanner used by Po1s0n1vy? Type the company name.
##### thoughts
Hmmm, as I revealed the attackers ip, I can now inspect the traffic between the attacker and the web-server. Probably, there are some traces which lead me to the correct answer?
##### approach
First, I narrow the data from the http-stream between the attacker and the web-server to post-requests and take a look at the user-agents. `index=* imreallynotbatman.com sourcetype="stream:http" src_ip="40.80.148.42" http_method=POST http_user_agent="Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21"`will do that.
##### result
Oh yes, as guessed, there are some traces left. Right after the user-agent, there is something written about _Acunetix Web Vulnerability Scanner - Free Edition_
![Solution q102](/images/splunk/102_1.png)

###### 103-What content management system is imreallynotbatman.com likely using?
##### thoughts
Also this question should be pretty easy to answer. 
##### approach
Let's just look for some hints about well known _cms_ in the same traffic I allready searched to answer the previous questions.
##### result
In the tag dest_header, there are many URL's cointaining _joomla_, so this is likely the correct answer.
![Solution q103](/images/splunk/102_1.png)

###### 104-What is the name of the file that defaced the imreallynotbatman.com website?
##### thoughts
##### approach
##### result
###### 105-This attack used dynamic DNS to resolve to the malicious IP. What fully qualified domain name (FQDN) is associated with this attack?
##### thoughts
##### approach
##### result
###### 106-What IP address has Po1s0n1vy tied to domains that are pre-staged to attack Wayne Enterprises?
##### thoughts
##### approach
##### result
###### 107-Based on the data gathered from this attack and common open source intelligence sources for domain names; what is the email address that is most likely associated with Po1s0n1vy APT group?
##### thoughts
##### approach
##### result
###### 108-What IP address is likely attempting a brute force password attack against imreallynotbatman.com?
##### thoughts
##### approach
##### result
###### 109-What is the name of the executable uploaded by Po1s0n1vy?
##### thoughts
##### approach
##### result
###### 110-What is the MD5 hash of the executable uploaded?
##### thoughts
##### approach
##### result
###### 111-GCPD reported that common TTPs (Tactics; Techniques; Procedures) for the Po1s0n1vy APT group; if initial compromise fails; is to send a spear phishing email with custom malware attached to their intended target. This malware is usually connected to Po1s0n1vys initial attack infrastructure. Using research techniques; provide the SHA256 hash of this malware.
##### thoughts
##### approach
##### result
###### 112-What special hex code is associated with the customized malware discussed in question 111? (Hint: It's not in Splunk)
##### thoughts
##### approach
##### result
###### 113-One of Po1s0n1vy's staged domains has some disjointed "unique" whois information. Concatenate the two codes together and submit as a single answer.
##### thoughts
##### approach
##### result
###### 114-What was the first brute force password used?
##### thoughts
##### approach
##### result
###### 115-One of the passwords in the brute force attack is James Brodsky's favorite Coldplay song. Hint: we are looking for a six character word on this one. Which is it?
##### thoughts
##### approach
##### result
###### 116-What was the correct password for admin access to the content management system running "imreallynotbatman.com"?
##### thoughts
##### approach
##### result
###### 117-What was the average password length used in the password brute forcing attempt?
##### thoughts
##### approach
##### result
###### 118-How many seconds elapsed between the time the brute force password scan identified the correct password and the compromised login?
##### thoughts
##### approach
##### result
###### 119-How many unique passwords were attempted in the brute force attempt?
##### thoughts
##### approach
##### result
###### 200-What was the most likely IP address of we8105desk on 24AUG2016?
##### thoughts
This is probabaly also one of the easier questions. As there is a known hostname and a known date, the search should quick be done.
##### approach
##### result


##### thoughts
##### approach
##### result